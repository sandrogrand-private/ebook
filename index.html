<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recipe eBooks</title>

  <!-- Tailwind CDN (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Small polish without extra dependencies */
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.7); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-zinc-50 to-white text-zinc-900">
  <header class="sticky top-0 z-10 border-b border-zinc-200/70 glass">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-2xl bg-zinc-900 text-white grid place-items-center font-semibold">RG</div>
        <div>
          <div id="siteTitle" class="text-base font-semibold leading-tight">Recipe eBooks</div>
          <div id="siteTagline" class="text-sm text-zinc-600 leading-tight">Cookbooks you’ll actually use.</div>
        </div>
      </div>

      <a id="primaryCta" href="#books" class="inline-flex items-center rounded-xl bg-zinc-900 px-4 py-2 text-sm font-semibold text-white hover:bg-zinc-800">
        Browse books
      </a>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4">
    <section class="py-10 md:py-14">
      <div class="grid gap-6 md:grid-cols-2 md:items-center">
        <div>
          <h1 class="text-3xl md:text-5xl font-semibold tracking-tight">
            Beautiful recipe eBooks.<br class="hidden md:block" />
            Clear steps. Big flavor.
          </h1>
          <p class="mt-4 text-zinc-600 text-base md:text-lg max-w-prose">
            Browse the full collection below. Each book includes tested recipes, practical techniques, and a clean layout made for cooking.
          </p>

          <div class="mt-6 flex flex-col sm:flex-row gap-3">
            <a href="#books" class="inline-flex justify-center rounded-xl bg-zinc-900 px-5 py-3 text-sm font-semibold text-white hover:bg-zinc-800">
              View all books
            </a>
            <a href="#faq" class="inline-flex justify-center rounded-xl border border-zinc-300 px-5 py-3 text-sm font-semibold text-zinc-900 hover:bg-zinc-50">
              How it works
            </a>
          </div>
        </div>

        <div class="rounded-3xl border border-zinc-200 bg-white p-6 shadow-sm">
          <div class="flex items-center justify-between gap-3">
            <div class="text-sm font-semibold">Search</div>
            <div id="countBadge" class="text-xs rounded-full bg-zinc-100 px-3 py-1 text-zinc-700">0 books</div>
          </div>
          <input id="q" type="search" placeholder="Title, tag, language…"
            class="mt-3 w-full rounded-xl border border-zinc-300 bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-zinc-900/20" />

          <div id="tagRow" class="mt-4 flex flex-wrap gap-2"></div>

          <div class="mt-5 text-xs text-zinc-500">
            Tip: keep your catalog in <span class="font-mono">books.json</span> and the page updates automatically.
          </div>
        </div>
      </div>
    </section>

    <section id="books" class="pb-14">
      <div class="flex items-end justify-between gap-3">
        <h2 class="text-xl md:text-2xl font-semibold">Books</h2>

        <select id="sort" class="rounded-xl border border-zinc-300 bg-white px-3 py-2 text-sm">
          <option value="new">Newest</option>
          <option value="az">Title A–Z</option>
        </select>
      </div>

      <div id="grid" class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>

      <div id="empty" class="hidden mt-10 rounded-2xl border border-zinc-200 bg-white p-6 text-zinc-600">
        No books match your search.
      </div>
    </section>

    <section id="faq" class="pb-16">
      <h2 class="text-xl md:text-2xl font-semibold">How it works</h2>
      <div class="mt-4 grid gap-4 md:grid-cols-3">
        <div class="rounded-2xl border border-zinc-200 bg-white p-5">
          <div class="font-semibold">1) Add books</div>
          <p class="mt-1 text-sm text-zinc-600">Edit <span class="font-mono">books.json</span>: title, description, cover, buy link.</p>
        </div>
        <div class="rounded-2xl border border-zinc-200 bg-white p-5">
          <div class="font-semibold">2) Upload covers</div>
          <p class="mt-1 text-sm text-zinc-600">Put images in <span class="font-mono">/covers</span> or use direct image URLs.</p>
        </div>
        <div class="rounded-2xl border border-zinc-200 bg-white p-5">
          <div class="font-semibold">3) Publish</div>
          <p class="mt-1 text-sm text-zinc-600">Host free on GitHub Pages / Netlify / Cloudflare Pages.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-t border-zinc-200/70">
    <div class="mx-auto max-w-6xl px-4 py-8 text-sm text-zinc-600 flex flex-col sm:flex-row justify-between gap-2">
      <div>© <span id="year"></span> Recipe Gems</div>
      <div class="opacity-80">Made with a simple JSON catalog.</div>
    </div>
  </footer>

<script>
  const el = (id) => document.getElementById(id);

  const state = {
    data: null,
    query: "",
    activeTag: null,
    sort: "new",
  };

  function normalize(s) { return (s || "").toString().toLowerCase().trim(); }

  function renderTags(books) {
    const tagSet = new Set();
    books.forEach(b => (b.tags || []).forEach(t => tagSet.add(t)));
    const tags = Array.from(tagSet).sort((a,b) => a.localeCompare(b));

    const row = el("tagRow");
    row.innerHTML = "";

    const mkBtn = (label, tag) => {
      const btn = document.createElement("button");
      btn.className =
        "text-xs rounded-full border px-3 py-1.5 hover:bg-zinc-50 " +
        (state.activeTag === tag ? "border-zinc-900 bg-zinc-900 text-white" : "border-zinc-300 text-zinc-700");
      btn.textContent = label;
      btn.onclick = () => {
        state.activeTag = (state.activeTag === tag) ? null : tag;
        render();
      };
      return btn;
    };

    row.appendChild(mkBtn("All", null));
    tags.forEach(t => row.appendChild(mkBtn(t, t)));
  }

  function bookMatches(b) {
    const q = normalize(state.query);
    if (!q && !state.activeTag) return true;

    const hay = [
      b.title, b.description, b.language, b.format,
      ...(b.tags || [])
    ].map(normalize).join(" • ");

    const tagOk = state.activeTag ? (b.tags || []).includes(state.activeTag) : true;
    const qOk = q ? hay.includes(q) : true;

    return tagOk && qOk;
  }

  function sortBooks(list) {
    if (state.sort === "az") {
      return [...list].sort((a,b) => (a.title || "").localeCompare(b.title || ""));
    }
    // newest
    return [...list].sort((a,b) => (normalize(b.published)).localeCompare(normalize(a.published)));
  }

  function card(book) {
    const div = document.createElement("div");
    div.className = "group rounded-3xl border border-zinc-200 bg-white shadow-sm hover:shadow-md transition-shadow overflow-hidden";

    const cover = book.cover || "";
    const title = book.title || "Untitled";
    const desc = book.description || "";
    const fmt = book.format || "";
    const lang = book.language || "";
    const tags = book.tags || [];
    const buy = book.buy_url || "#";

    div.innerHTML = `
      <div class="aspect-[4/5] bg-zinc-100 overflow-hidden">
        <img src="${cover}" alt="${title} cover"
             class="h-full w-full object-cover group-hover:scale-[1.02] transition-transform"
             loading="lazy"
             onerror="this.style.display='none'; this.parentElement.classList.add('grid','place-items-center'); this.parentElement.innerHTML='<div class=\\'text-sm text-zinc-500 p-6 text-center\\'>Add a cover image<br><span class=\\'font-mono\\'>${book.cover || "covers/your-book.jpg"}</span></div>';">
      </div>
      <div class="p-5">
        <div class="flex items-start justify-between gap-3">
          <h3 class="text-base font-semibold leading-snug">${title}</h3>
        </div>
        <p class="mt-2 text-sm text-zinc-600 leading-relaxed line-clamp-4">${desc}</p>

        <div class="mt-4 flex flex-wrap gap-2">
          ${lang ? `<span class="text-xs rounded-full bg-zinc-100 px-3 py-1 text-zinc-700">${lang}</span>` : ""}
          ${fmt ? `<span class="text-xs rounded-full bg-zinc-100 px-3 py-1 text-zinc-700">${fmt}</span>` : ""}
          ${tags.slice(0,3).map(t => `<span class="text-xs rounded-full bg-zinc-100 px-3 py-1 text-zinc-700">${t}</span>`).join("")}
        </div>

        <div class="mt-5 flex gap-2">
          <a href="${buy}" target="_blank" rel="noopener"
             class="inline-flex flex-1 justify-center rounded-xl bg-zinc-900 px-4 py-2.5 text-sm font-semibold text-white hover:bg-zinc-800">
             Buy / Download
          </a>
          <button class="rounded-xl border border-zinc-300 px-3 py-2.5 text-sm font-semibold hover:bg-zinc-50"
                  onclick="navigator.clipboard.writeText('${buy}'); this.textContent='Copied'; setTimeout(()=>this.textContent='Copy link',900);">
            Copy link
          </button>
        </div>
      </div>
    `;
    return div;
  }

  function render() {
    const books = state.data?.books || [];
    const filtered = sortBooks(books.filter(bookMatches));

    el("countBadge").textContent = `${filtered.length} book${filtered.length === 1 ? "" : "s"}`;

    const grid = el("grid");
    grid.innerHTML = "";
    filtered.forEach(b => grid.appendChild(card(b)));

    el("empty").classList.toggle("hidden", filtered.length !== 0);

    // rerender tag styles
    renderTags(books);
  }

  async function init() {
    el("year").textContent = new Date().getFullYear();

    const res = await fetch("books.json", { cache: "no-store" });
    state.data = await res.json();

    // set site header if present
    if (state.data.site?.title) el("siteTitle").textContent = state.data.site.title;
    if (state.data.site?.tagline) el("siteTagline").textContent = state.data.site.tagline;

    el("q").addEventListener("input", (e) => { state.query = e.target.value; render(); });
    el("sort").addEventListener("change", (e) => { state.sort = e.target.value; render(); });

    render();
  }

  init().catch(err => {
    console.error(err);
    document.body.innerHTML =
      "<div style='padding:24px;font-family:system-ui'>Could not load <b>books.json</b>. Make sure it’s in the same folder as <b>index.html</b>.</div>";
  });
</script>
</body>
</html>
